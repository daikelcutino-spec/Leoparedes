<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Bot NOCTURNO - Control Total</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: white;
            color: #667eea;
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .panel h2 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel h3 {
            color: #764ba2;
            font-size: 1.1em;
            margin: 15px 0 10px 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .input-group input, .input-group select {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #764ba2;
            transform: scale(1.02);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-info {
            background: #17a2b8;
        }

        .btn-info:hover {
            background: #138496;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 10px;
        }

        .list {
            list-style: none;
            max-height: 250px;
            overflow-y: auto;
        }

        .list-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
        }

        .list-item:hover {
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 1.8em;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .bot-console {
            background: #1a1a2e;
            color: #00ff41;
            padding: 15px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-top: 15px;
        }

        .bot-console::-webkit-scrollbar {
            width: 8px;
        }

        .bot-console::-webkit-scrollbar-track {
            background: #0f0f1e;
        }

        .bot-console::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .console-line {
            margin: 3px 0;
            line-height: 1.4;
        }

        .console-timestamp {
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Panel Bot NOCTURNO</h1>
            <p style="color: #666; font-size: 0.95em;">Control Total & Monitoreo</p>
        </div>

        <!-- Consola de Respuestas del Bot -->
        <div class="panel">
            <h2>ğŸ’¬ Consola de Respuestas del Bot</h2>
            <div id="botConsole" class="bot-console">
                <div class="console-line">ğŸ¤– Esperando respuestas del bot...</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="value">{{ vip_count }}</div>
                <div class="label">â­ VIPs</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ total_hearts }}</div>
                <div class="label">ğŸ’– Corazones</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ total_users }}</div>
                <div class="label">ğŸ‘¥ Usuarios</div>
            </div>
            <div class="stat-card">
                <div class="value">{{ total_messages }}</div>
                <div class="label">ğŸ’¬ Mensajes</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('overview')">ğŸ“Š Resumen</button>
            <button class="tab-btn" onclick="openTab('moderation')">ğŸ”¨ ModeraciÃ³n</button>
            <button class="tab-btn" onclick="openTab('economy')">ğŸ’° EconomÃ­a</button>
            <button class="tab-btn" onclick="openTab('emotes')">ğŸ­ Emotes</button>
            <button class="tab-btn" onclick="openTab('teleport')">âš¡ Teleporte</button>
            <button class="tab-btn" onclick="openTab('interactions')">ğŸ¥Š Interacciones</button>
            <button class="tab-btn" onclick="openTab('bot')">ğŸ¤– Bot Control</button>
        </div>

        <!-- TAB: RESUMEN -->
        <div id="overview" class="tab-content active">
            <div class="panel">
                <h2>ğŸ† Top Rankings</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3>ğŸ’– Top Corazones</h3>
                        <ul class="list">
                            {% for username, hearts in top_hearts[:10] %}
                            <li class="list-item">
                                <span>{{ username }}</span>
                                <span style="color: #667eea; font-weight: bold;">{{ hearts }} â¤ï¸</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div>
                        <h3>ğŸ’¬ Top Actividad</h3>
                        <ul class="list">
                            {% for username, msgs in top_activity[:10] %}
                            <li class="list-item">
                                <span>{{ username }}</span>
                                <span style="color: #764ba2; font-weight: bold;">{{ msgs }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>ğŸ® Acciones RÃ¡pidas</h2>
                <div class="actions-grid">
                    <button class="btn" onclick="sendCommand('!help')">ğŸ“– Ayuda</button>
                    <button class="btn" onclick="sendCommand('!stats')">ğŸ“Š EstadÃ­sticas</button>
                    <button class="btn" onclick="sendCommand('!online')">ğŸ‘¥ Online</button>
                    <button class="btn btn-info" onclick="location.reload()">ğŸ”„ Actualizar</button>
                </div>
            </div>
        </div>

        <!-- TAB: MODERACIÃ“N -->
        <div id="moderation" class="tab-content">
            <div class="panel">
                <h2>ğŸ”¨ ModeraciÃ³n de Usuarios</h2>

                <h3>â­ GestiÃ³n VIP</h3>
                <div class="input-group">
                    <input type="text" id="vipUsername" placeholder="@username">
                    <button class="btn btn-success" onclick="addVIP()">Agregar VIP</button>
                    <button class="btn btn-danger" onclick="removeVIP()">Quitar VIP</button>
                    <button class="btn" onclick="checkVIP()">Verificar VIP</button>
                </div>

                <h3>ğŸš« Sanciones</h3>
                <div class="input-group">
                    <input type="text" id="banUsername" placeholder="@username">
                    <button class="btn btn-danger" onclick="banUser()">ğŸš« Banear</button>
                    <button class="btn" onclick="unbanUser()">âœ… Desbanear</button>
                    <button class="btn btn-warning" onclick="kickUser()">ğŸ‘¢ Expulsar</button>
                </div>

                <h3>ğŸ”‡ Silenciamiento</h3>
                <div class="input-group">
                    <input type="text" id="muteUsername" placeholder="@username">
                    <input type="number" id="muteSeconds" placeholder="Segundos" min="1" value="60">
                    <button class="btn btn-warning" onclick="muteUser()">ğŸ”‡ Silenciar</button>
                    <button class="btn" onclick="unmuteUser()">ğŸ”Š Quitar Silencio</button>
                </div>

                <h3>ğŸ§Š Otras Acciones</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="openModal('freezeModal')">ğŸ§Š Congelar</button>
                    <button class="btn" onclick="sendCommand('!banlist')">ğŸ“‹ Lista Baneados</button>
                    <button class="btn" onclick="sendCommand('!mutelist')">ğŸ“‹ Lista Silenciados</button>
                    <button class="btn" onclick="openModal('privilegeModal')">ğŸ” Ver Privilegios</button>
                </div>
            </div>
        </div>

        <!-- TAB: ECONOMÃA -->
        <div id="economy" class="tab-content">
            <div class="panel">
                <h2>ğŸ’° Sistema EconÃ³mico</h2>

                <h3>ğŸ’– Corazones</h3>
                <div class="input-group">
                    <input type="text" id="heartUsername" placeholder="@username">
                    <input type="number" id="heartAmount" placeholder="Cantidad" min="1" max="100" value="1">
                    <button class="btn btn-success" onclick="giveHearts()">ğŸ’– Dar Corazones</button>
                    <button class="btn" onclick="heartAll()">ğŸ’ Corazones a Todos</button>
                </div>

                <h3>ğŸ’° Propinas (Oro)</h3>
                <div class="input-group">
                    <input type="number" id="tipAmount" placeholder="Cantidad (1-5)" min="1" max="5" value="1">
                    <button class="btn btn-success" onclick="tipAll()">ğŸ’° Dar a Todos</button>
                </div>
                <div class="input-group">
                    <input type="number" id="tipOnlyAmount" placeholder="NÃºmero de usuarios" min="1">
                    <button class="btn btn-warning" onclick="tipRandom()">ğŸ² Dar Aleatorio</button>
                </div>

                <h3>ğŸ“Š EconomÃ­a</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="sendCommand('!wallet')">ğŸ’° Ver Balance</button>
                    <button class="btn" onclick="sendCommand('!leaderboard heart')">ğŸ† Top Corazones</button>
                    <button class="btn" onclick="sendCommand('!leaderboard active')">ğŸ“ˆ Top Actividad</button>
                </div>
            </div>
        </div>

        <!-- TAB: EMOTES -->
        <div id="emotes" class="tab-content">
            <div class="panel">
                <h2>ğŸ­ Control de Emotes</h2>

                <h3>ğŸ­ Enviar Emote</h3>
                <div class="input-group">
                    <input type="text" id="emoteTarget" placeholder="@username o 'all'">
                    <input type="text" id="emoteId" placeholder="Emote (1-224 o nombre)">
                    <button class="btn" onclick="sendEmoteToUser()">ğŸ­ Enviar</button>
                </div>

                <h3>ğŸ›‘ Detener Emotes</h3>
                <div class="input-group">
                    <input type="text" id="stopEmoteTarget" placeholder="@username o 'all'">
                    <button class="btn btn-danger" onclick="stopEmote()">ğŸ›‘ Detener</button>
                    <button class="btn btn-danger" onclick="stopAllEmotes()">â¹ï¸ Detener Todos</button>
                </div>

                <h3>ğŸ¤– Modo Bot</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="sendCommand('!automode')">ğŸ­ Modo Auto (224 emotes)</button>
                    <button class="btn" onclick="sendCommand('!emote list')">ğŸ“‹ Lista Emotes</button>
                </div>

                <div class="info-box">
                    ğŸ’¡ <strong>Tip:</strong> Usa nÃºmeros 1-224 o nombres de emotes. El modo auto ejecuta todos los 224 emotes en ciclo continuo.
                </div>
            </div>
        </div>

        <!-- TAB: TELEPORTE -->
        <div id="teleport" class="tab-content">
            <div class="panel">
                <h2>âš¡ Sistema de Teletransporte</h2>

                <h3>ğŸ“ Teletransporte Flash</h3>
                <div class="input-group">
                    <input type="number" id="flashX" placeholder="X" step="0.1">
                    <input type="number" id="flashY" placeholder="Y" step="0.1">
                    <input type="number" id="flashZ" placeholder="Z" step="0.1">
                    <button class="btn" onclick="flashTeleport()">âš¡ Flash</button>
                </div>

                <h3>ğŸ¯ Traer Usuario</h3>
                <div class="input-group">
                    <input type="text" id="bringUsername" placeholder="@username">
                    <button class="btn btn-success" onclick="bringUser()">ğŸ¯ Traer a MÃ­</button>
                </div>

                <h3>ğŸ—ºï¸ Puntos de Teleporte</h3>
                <div class="input-group">
                    <input type="text" id="tpPointName" placeholder="Nombre del punto">
                    <button class="btn" onclick="teleportToPoint()">ğŸ“ Ir a Punto</button>
                    <button class="btn btn-info" onclick="sendCommand('!tplist')">ğŸ“‹ Lista Puntos</button>
                </div>

                <h3>â• Crear Puntos (Admin)</h3>
                <div class="input-group">
                    <input type="text" id="newPointName" placeholder="Nombre del nuevo punto">
                    <button class="btn btn-success" onclick="createPoint()">â• Crear Punto</button>
                    <button class="btn btn-danger" onclick="deletePoint()">ğŸ—‘ï¸ Eliminar Punto</button>
                </div>

                <h3>ğŸ  Zonas Especiales (Owner)</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="sendCommand('!setvipzone')">â­ Zona VIP</button>
                    <button class="btn" onclick="sendCommand('!setdj')">ğŸµ Zona DJ</button>
                    <button class="btn" onclick="sendCommand('!setdirectivo')">ğŸ‘‘ Zona Directivo</button>
                </div>
            </div>
        </div>

        <!-- TAB: INTERACCIONES -->
        <div id="interactions" class="tab-content">
            <div class="panel">
                <h2>ğŸ¥Š Interacciones entre Usuarios</h2>

                <h3>ğŸ¯ Seleccionar Objetivo</h3>
                <div class="input-group">
                    <input type="text" id="interactionTarget" placeholder="@username">
                </div>

                <h3>ğŸ’ Acciones Positivas</h3>
                <div class="actions-grid">
                    <button class="btn btn-success" onclick="interact('hug')">ğŸ¤— Abrazar</button>
                    <button class="btn btn-success" onclick="interact('flirt')">ğŸ’• Coquetear</button>
                    <button class="btn btn-success" onclick="interact('laugh')">ğŸ˜‚ ReÃ­r</button>
                </div>

                <h3>ğŸ¥Š Acciones de Combate</h3>
                <div class="actions-grid">
                    <button class="btn btn-warning" onclick="interact('punch')">ğŸ¥Š Golpear</button>
                    <button class="btn btn-warning" onclick="interact('slap')">ğŸ‘‹ Bofetada</button>
                    <button class="btn btn-warning" onclick="interact('ninja')">ğŸ¥· Ninja</button>
                    <button class="btn btn-danger" onclick="interact('boom')">ğŸ’¥ Explotar</button>
                </div>

                <h3>ğŸ˜± Acciones Especiales</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="interact('scare')">ğŸ˜± Asustar</button>
                    <button class="btn" onclick="interact('electro')">âš¡ Electrocutar</button>
                </div>

                <h3>ğŸ’« Reacciones</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="react('thumbs')">ğŸ‘ Pulgar Arriba</button>
                    <button class="btn" onclick="react('clap')">ğŸ‘ Aplaudir</button>
                    <button class="btn" onclick="react('wave')">ğŸ‘‹ Saludar</button>
                </div>

                <div class="info-box">
                    ğŸ’¡ Las interacciones generan animaciones entre usuarios. Las reacciones pueden enviarse mÃºltiples veces.
                </div>
            </div>
        </div>

        <!-- TAB: BOT CONTROL -->
        <div id="bot" class="tab-content">
            <div class="panel">
                <h2>ğŸ¤– Control del Bot</h2>

                <h3>ğŸ“ Movimiento del Bot</h3>
                <div class="input-group">
                    <input type="text" id="botTargetUser" placeholder="@username">
                    <button class="btn" onclick="sendCommand('!tome')">ğŸ¤– Bot a MÃ­</button>
                    <button class="btn btn-warning" onclick="botAttack()">âš”ï¸ Bot Ataca</button>
                </div>

                <h3>ğŸ‘” Apariencia</h3>
                <div class="input-group">
                    <input type="number" id="outfitNumber" placeholder="NÃºmero de outfit" min="1">
                    <button class="btn" onclick="changeOutfit()">ğŸ‘” Cambiar Outfit</button>
                    <button class="btn" onclick="sendCommand('!copyoutfit')">ğŸ“‹ Copiar Mi Outfit</button>
                </div>

                <h3>ğŸ­ Comportamiento</h3>
                <div class="input-group">
                    <input type="text" id="mimicTarget" placeholder="@username">
                    <button class="btn" onclick="mimicUser()">ğŸ­ Imitar Usuario</button>
                </div>

                <h3>ğŸ’¬ Bot Habla</h3>
                <div class="input-group">
                    <input type="text" id="botMessage" placeholder="Mensaje del bot" style="flex: 2;">
                    <button class="btn btn-success" onclick="botSay()">ğŸ’¬ Enviar</button>
                </div>

                <h3>ğŸµ DJ & MÃºsica</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="sendCommand('!dj')">ğŸµ Panel DJ</button>
                    <button class="btn btn-success" onclick="sendCommand('!music play')">â–¶ï¸ Play</button>
                    <button class="btn btn-warning" onclick="sendCommand('!music pause')">â¸ï¸ Pause</button>
                    <button class="btn btn-danger" onclick="sendCommand('!music stop')">â¹ï¸ Stop</button>
                </div>

                <h3>ğŸ“¦ Inventario</h3>
                <div class="actions-grid">
                    <button class="btn" onclick="sendCommand('!inventory')">ğŸ“¦ Ver Inventario</button>
                    <button class="btn" onclick="openModal('giveItemModal')">ğŸ Dar Item</button>
                </div>

                <h3>âš™ï¸ Sistema</h3>
                <div class="actions-grid">
                    <button class="btn btn-danger" onclick="confirmRestart()">ğŸ”„ Reiniciar Bot</button>
                    <button class="btn btn-info" onclick="location.reload()">ğŸ”„ Actualizar Panel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALES -->

    <!-- Modal Freeze -->
    <div id="freezeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('freezeModal')">&times;</span>
            <h2>ğŸ§Š Congelar Usuario</h2>
            <div class="input-group">
                <input type="text" id="freezeUsername" placeholder="@username">
                <button class="btn btn-warning" onclick="freezeUser()">ğŸ§Š Congelar</button>
            </div>
            <p style="margin-top: 10px; font-size: 0.9em; color: #666;">Congela al usuario por 5 minutos</p>
        </div>
    </div>

    <!-- Modal Privilege -->
    <div id="privilegeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('privilegeModal')">&times;</span>
            <h2>ğŸ” Ver Privilegios</h2>
            <div class="input-group">
                <input type="text" id="privilegeUsername" placeholder="@username">
                <button class="btn" onclick="checkPrivilege()">ğŸ” Verificar</button>
            </div>
        </div>
    </div>

    <!-- Modal Give Item -->
    <div id="giveItemModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('giveItemModal')">&times;</span>
            <h2>ğŸ Dar Item</h2>
            <div class="input-group">
                <input type="text" id="giveItemUsername" placeholder="@username">
            </div>
            <div class="input-group">
                <input type="text" id="giveItemId" placeholder="Item ID">
            </div>
            <button class="btn btn-success" onclick="giveItem()" style="width: 100%;">ğŸ Dar Item</button>
        </div>
    </div>

    <script>
        // Helper function to escape HTML entities
        function escapeHtml(unsafe) {
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        }

        // Sistema de Tabs
        function openTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');

            contents.forEach(c => c.classList.remove('active'));
            buttons.forEach(b => b.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Funciones de Modal
        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // FunciÃ³n base para enviar comandos
        function sendCommand(cmd) {
            fetch('/api/send_command', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({command: cmd})
            }).then(r => r.json()).then(d => {
                alert(d.message || 'Comando enviado: ' + cmd);
            }).catch(e => alert('Error: ' + e));
        }

        // MODERACIÃ“N
        function addVIP() {
            const username = document.getElementById('vipUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');

            fetch('/api/add_vip', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'username=' + username
            }).then(r => r.json()).then(d => {
                alert(d.message);
                if (d.success) location.reload();
            });
        }

        function removeVIP() {
            const username = document.getElementById('vipUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');

            fetch('/api/remove_vip', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'username=' + username
            }).then(r => r.json()).then(d => {
                alert(d.message);
                if (d.success) location.reload();
            });
        }

        function checkVIP() {
            const username = document.getElementById('vipUsername').value.replace('@', '');
            sendCommand('!checkvip' + (username ? ' @' + username : ''));
        }

        function banUser() {
            const username = document.getElementById('banUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');
            sendCommand('!ban @' + username);
        }

        function unbanUser() {
            const username = document.getElementById('banUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');
            sendCommand('!unban @' + username);
        }

        function kickUser() {
            const username = document.getElementById('banUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');
            sendCommand('!kick @' + username);
        }

        function muteUser() {
            const username = document.getElementById('muteUsername').value.replace('@', '');
            const seconds = document.getElementById('muteSeconds').value || '60';
            if (!username) return alert('Ingresa un username');
            sendCommand('!mute @' + username + ' ' + seconds);
        }

        function unmuteUser() {
            const username = document.getElementById('muteUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');
            sendCommand('!unmute @' + username);
        }

        function freezeUser() {
            const username = document.getElementById('freezeUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');
            sendCommand('!freeze @' + username);
            closeModal('freezeModal');
        }

        function checkPrivilege() {
            const username = document.getElementById('privilegeUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');
            sendCommand('!privilege @' + username);
            closeModal('privilegeModal');
        }

        // ECONOMÃA
        function giveHearts() {
            const username = document.getElementById('heartUsername').value.replace('@', '');
            const amount = document.getElementById('heartAmount').value || '1';
            if (!username) return alert('Ingresa un username');
            sendCommand('!heart @' + username + ' ' + amount);
        }

        function heartAll() {
            sendCommand('!heartall');
        }

        function tipAll() {
            const amount = document.getElementById('tipAmount').value;
            if (!amount || amount < 1 || amount > 5) return alert('Cantidad debe ser 1-5');
            sendCommand('!tip all ' + amount);
        }

        function tipRandom() {
            const amount = document.getElementById('tipOnlyAmount').value;
            if (!amount || amount < 1) return alert('Ingresa nÃºmero de usuarios');
            sendCommand('!tip only ' + amount);
        }

        // EMOTES
        function sendEmoteToUser() {
            const target = document.getElementById('emoteTarget').value.replace('@', '');
            const emote = document.getElementById('emoteId').value;
            if (!target || !emote) return alert('Completa todos los campos');

            if (target.toLowerCase() === 'all') {
                sendCommand('!emote all ' + emote);
            } else {
                sendCommand('!emote @' + target + ' ' + emote);
            }
        }

        function stopEmote() {
            const target = document.getElementById('stopEmoteTarget').value.replace('@', '');
            if (!target) return alert('Ingresa un username o "all"');
            sendCommand('!stop ' + (target.toLowerCase() === 'all' ? 'all' : '@' + target));
        }

        function stopAllEmotes() {
            sendCommand('!stopall');
        }

        // TELEPORTE
        function flashTeleport() {
            const x = document.getElementById('flashX').value;
            const y = document.getElementById('flashY').value;
            const z = document.getElementById('flashZ').value;
            if (!x || !y || !z) return alert('Completa las coordenadas');
            sendCommand('!flash ' + x + ' ' + y + ' ' + z);
        }

        function bringUser() {
            const username = document.getElementById('bringUsername').value.replace('@', '');
            if (!username) return alert('Ingresa un username');
            sendCommand('!bring @' + username);
        }

        function teleportToPoint() {
            const point = document.getElementById('tpPointName').value;
            if (!point) return alert('Ingresa el nombre del punto');
            sendCommand('!tp ' + point);
        }

        function createPoint() {
            const name = document.getElementById('newPointName').value;
            if (!name) return alert('Ingresa un nombre para el punto');
            sendCommand('!TPus ' + name);
        }

        function deletePoint() {
            const name = document.getElementById('newPointName').value;
            if (!name) return alert('Ingresa el nombre del punto');
            sendCommand('!delpoint ' + name);
        }

        // INTERACCIONES
        function interact(action) {
            const target = document.getElementById('interactionTarget').value.replace('@', '');
            if (!target) return alert('Ingresa un username');
            sendCommand('!' + action + ' @' + target);
        }

        function react(reaction) {
            const target = document.getElementById('interactionTarget').value.replace('@', '');
            if (!target) return alert('Ingresa un username');
            sendCommand('!' + reaction + ' @' + target);
        }

        // BOT CONTROL
        function botAttack() {
            const target = document.getElementById('botTargetUser').value.replace('@', '');
            if (!target) return alert('Ingresa un username');
            sendCommand('!bot @' + target);
        }

        function changeOutfit() {
            const num = document.getElementById('outfitNumber').value;
            if (!num) return alert('Ingresa nÃºmero de outfit');
            sendCommand('!outfit ' + num);
        }

        function mimicUser() {
            const target = document.getElementById('mimicTarget').value.replace('@', '');
            if (!target) return alert('Ingresa un username');
            sendCommand('!mimic @' + target);
        }

        function botSay() {
            const message = document.getElementById('botMessage').value;
            if (!message) return alert('Ingresa un mensaje');
            sendCommand('!say ' + message);
        }

        function giveItem() {
            const username = document.getElementById('giveItemUsername').value.replace('@', '');
            const itemId = document.getElementById('giveItemId').value;
            if (!username || !itemId) return alert('Completa todos los campos');
            sendCommand('!give @' + username + ' ' + itemId);
            closeModal('giveItemModal');
        }

        function confirmRestart() {
            if (confirm('Â¿EstÃ¡s seguro de reiniciar el bot?\nEsto detendrÃ¡ el bot completamente.')) {
                sendCommand('!restart');
            }
        }

        // Actualizar consola de respuestas del bot
        async function updateBotConsole() {
            try {
                const response = await fetch('/api/bot_responses');
                const data = await response.json();

                const consoleDiv = document.getElementById('botConsole');
                
                if (data.success && data.responses && Array.isArray(data.responses) && data.responses.length > 0) {
                    const lines = data.responses
                        .filter(line => line && line.trim() && !line.trim().startsWith('#'))
                        .map(line => {
                            const trimmed = line.trim();
                            // Colorear segÃºn el tipo de mensaje
                            if (trimmed.includes('BOT â†’')) {
                                return `<div class="console-line" style="color: #00ff00;">${escapeHtml(trimmed)}</div>`;
                            } else if (trimmed.startsWith('@')) {
                                return `<div class="console-line" style="color: #00bfff;">${escapeHtml(trimmed)}</div>`;
                            } else {
                                return `<div class="console-line">${escapeHtml(trimmed)}</div>`;
                            }
                        })
                        .join('');

                    if (lines) {
                        consoleDiv.innerHTML = lines;
                        // Auto scroll al final
                        consoleDiv.scrollTop = consoleDiv.scrollHeight;
                    } else {
                        consoleDiv.innerHTML = '<div class="console-line" style="color: #888;">ğŸ¤– Esperando comandos del bot...</div>';
                    }
                } else {
                    consoleDiv.innerHTML = '<div class="console-line" style="color: #888;">ğŸ¤– Esperando comandos del bot...</div>';
                }
            } catch (error) {
                console.error('Error actualizando consola:', error);
                const consoleDiv = document.getElementById('botConsole');
                if (consoleDiv) {
                    consoleDiv.innerHTML = '<div class="console-line" style="color: #ff6b6b;">âŒ Error cargando consola</div>';
                }
            }
        }

        // Actualizar consola cada 2 segundos
        setInterval(updateBotConsole, 2000);

        // Actualizar inmediatamente al cargar
        updateBotConsole();
    </script>
</body>
</html>