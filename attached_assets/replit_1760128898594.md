# Bot Cantinero para Highrise

## Descripci√≥n del Proyecto

Este es un bot para Highrise (plataforma social virtual) que funciona como un cantinero virtual. El bot puede servir bebidas, contar chistes, saludar a los usuarios y crear un ambiente divertido en la sala.

## Estructura del Proyecto

```
.
‚îú‚îÄ‚îÄ main.py           # C√≥digo principal del bot cantinero
‚îú‚îÄ‚îÄ README.md         # Documentaci√≥n del usuario
‚îú‚îÄ‚îÄ pyproject.toml    # Configuraci√≥n del proyecto Python
‚îî‚îÄ‚îÄ replit.md         # Este archivo - documentaci√≥n interna
```

## Tecnolog√≠as Utilizadas

- **Python 3.11+**: Lenguaje de programaci√≥n
- **highrise-bot-sdk 24.1.0**: SDK oficial de Highrise para bots
- **asyncio**: Para programaci√≥n as√≠ncrona
- **typing**: Para type hints

## Funcionalidades del Bot

### 1. Sistema de Men√∫
- Bebidas alcoh√≥licas (cerveza, vino, martini, margarita, whisky, champagne, tequila, ron, vodka)
- Bebidas sin alcohol (caf√©, refresco, jugo, agua, t√©, batido, bubble tea)
- Comando `!menu` para mostrar el cat√°logo completo

### 2. Comandos Interactivos
- `!menu` - Muestra el men√∫ de bebidas
- `!bebida [nombre]` - Pide una bebida espec√≠fica
- `!broma` o `!joke` - Cuenta un chiste
- `!salud` o `!cheers` - Hace un brindis
- `!ayuda` o `!help` - Muestra ayuda
- `!cantinero` - Llama al cantinero
- `!copy` - (Admin/Owner) Copia el outfit del usuario
- `!inicio` - (Admin/Owner) Establece la posici√≥n inicial del bot

### 3. Detecci√≥n Inteligente
El bot puede detectar cuando alguien menciona una bebida en el chat y servirla autom√°ticamente.

### 4. Saludos Personalizados
Saluda autom√°ticamente a los usuarios cuando entran a la sala con el mensaje:
"Bienvenido aüï∑Ô∏èNOCTURNO üï∑Ô∏è. El velo se ha abierto solo para ti. Tu presencia es una nueva sombra en nuestra oscuridad."

### 5. Entretenimiento
Incluye una colecci√≥n de chistes relacionados con bebidas y cantineros.

### 6. Loop Autom√°tico de Emote
El bot ejecuta autom√°ticamente el emote "floss" de forma continua (cada 1 segundo) para mantener un ambiente animado en la sala. Este loop se inicia autom√°ticamente al conectarse el bot.

### 7. Mensajes Autom√°ticos
Sistema de mensajes autom√°ticos que se env√≠an cada 1.5 minutos a todos los usuarios. Los mensajes se alternan en orden:
- Mensaje de soporte y contacto
- Mensaje de VIP permanente
- Mensaje de barra/cantinero

### 8. Sistema de Whisper
**TODAS** las interacciones del bot son privadas (whisper), incluyendo:
- Mensajes de bienvenida
- Respuestas a comandos
- Servicio de bebidas
- Mensajes autom√°ticos
- Mensajes de error/confirmaci√≥n

## Configuraci√≥n

### Credenciales de Highrise
- **API Token**: e85f532a8d3060b6e6bc2ebafdf9a657d052c51897524926f4e6b226edd7d68d
- **Room ID**: 686c527e9668a3cb40e1f58d
- **Owner ID**: 662aae9b602b4a897557ec18
- **Admin ID**: 669da7b73867bac51391c757

### Workflow
El bot se ejecuta mediante el workflow "BartenderBot" que usa el comando:
```bash
highrise main:BartenderBot 686c527e9668a3cb40e1f58d e85f532a8d3060b6e6bc2ebafdf9a657d052c51897524926f4e6b226edd7d68d
```

## Arquitectura del C√≥digo

### Clase Principal: BartenderBot
Hereda de `BaseBot` del SDK de Highrise.

#### Atributos:
- `owner_id`: ID del propietario de la sala
- `admin_id`: ID del administrador
- `bot_position`: Posici√≥n actual del bot (configurable)
- `menu`: Diccionario con bebidas alcoh√≥licas y sin alcohol
- `bartender_phrases`: Frases aleatorias al servir bebidas
- `auto_messages`: Lista de mensajes autom√°ticos
- `current_message_index`: √çndice del mensaje actual en rotaci√≥n

#### M√©todos Principales:
- `on_start()`: Se ejecuta cuando el bot se conecta e inicia los loops
- `floss_loop()`: Loop infinito que ejecuta el emote "floss" de forma continua (cada 1 segundo)
- `auto_message_loop()`: Loop que env√≠a mensajes autom√°ticos cada 1.5 minutos
- `on_user_join()`: Maneja cuando un usuario entra a la sala (whisper)
- `on_chat()`: Procesa mensajes del chat
- `handle_command()`: Maneja comandos espec√≠ficos
- `show_menu()`: Muestra el men√∫ de bebidas (whisper)
- `show_help()`: Muestra ayuda (whisper)
- `serve_drink()`: Sirve una bebida al usuario (whisper)
- `serve_drink_from_message()`: Detecta bebidas en mensajes
- `tell_joke()`: Cuenta un chiste aleatorio (whisper)
- `copy_outfit()`: Copia outfit del usuario (solo admin/owner)
- `set_bot_position()`: Establece posici√≥n del bot (solo admin/owner)

## Flujo de Ejecuci√≥n

1. El bot se inicia con el comando CLI de Highrise
2. Se conecta a la sala usando el Room ID y API Token
3. Ejecuta `on_start()` que:
   - Inicia el loop del emote floss
   - Inicia el loop de mensajes autom√°ticos
4. Escucha eventos:
   - Usuarios entrando (`on_user_join`) ‚Üí Env√≠a bienvenida en whisper
   - Mensajes en el chat (`on_chat`) ‚Üí Responde en whisper
5. Procesa comandos y responde seg√∫n la l√≥gica programada
6. Ejecuta loops en segundo plano:
   - Emote floss cada 30 segundos
   - Mensajes autom√°ticos cada 1.5 minutos

## Seguridad y Permisos

### Comandos Restringidos
Los siguientes comandos solo pueden ser ejecutados por el Owner o Admin:
- `!copy` - Copiar outfit
- `!inicio` - Establecer posici√≥n del bot

El bot verifica el `user.id` contra `owner_id` y `admin_id` antes de ejecutar estos comandos.

### Privacidad
Todos los mensajes se env√≠an mediante `send_whisper()` para garantizar privacidad. No hay mensajes p√∫blicos en el chat excepto cuando el usuario escribe comandos.

## Mantenimiento y Actualizaci√≥n

### Para a√±adir nuevas bebidas:
Edita el diccionario `self.menu` en el constructor de la clase.

### Para a√±adir nuevos mensajes autom√°ticos:
A√±ade elementos a la lista `self.auto_messages` en el constructor.

### Para cambiar la frecuencia de mensajes:
Modifica el valor en `await asyncio.sleep(90)` en `auto_message_loop()` (actualmente 90 segundos = 1.5 minutos).

### Para a√±adir nuevos chistes:
A√±ade elementos a la lista `jokes` en el m√©todo `tell_joke()`.

### Para cambiar IDs de admin/owner:
Modifica `self.owner_id` y `self.admin_id` en el constructor.

## Dependencias

Las dependencias se gestionan con `uv` (gestor de paquetes Python moderno):

```toml
[project]
dependencies = [
    "highrise-bot-sdk>=24.1.0",
]
```

## Notas de Desarrollo

- El bot usa programaci√≥n as√≠ncrona (async/await)
- Todos los m√©todos de eventos son as√≠ncronos
- El SDK maneja autom√°ticamente la conexi√≥n WebSocket
- Los mensajes privados se env√≠an con `await self.highrise.send_whisper(user_id, message)`
- Los loops se ejecutan con `asyncio.create_task()` para no bloquear el bot
- Manejo de errores con try/except en operaciones cr√≠ticas

## Estado Actual

‚úÖ Bot funcionando correctamente
‚úÖ Conectado a la sala de Highrise
‚úÖ Respondiendo a comandos en whisper
‚úÖ Sirviendo bebidas en whisper
‚úÖ Saludando usuarios en whisper
‚úÖ Mensajes autom√°ticos funcionando
‚úÖ Loop de emote floss activo
‚úÖ Comandos admin funcionando
‚úÖ Sistema de detecci√≥n de bebidas sin prefijo activo

## Fecha de Creaci√≥n

10 de octubre de 2025

## Idioma

El bot opera completamente en espa√±ol.
